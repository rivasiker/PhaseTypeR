<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using PhaseTypeR for the site frequency spectrum • PhaseTypeR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using PhaseTypeR for the site frequency spectrum">
<meta property="og:description" content="PhaseTypeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PhaseTypeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/PhaseTypeR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a2_pop_gen_iker.html">Using PhaseTypeR for population genetics</a>
    </li>
    <li>
      <a href="../articles/a3_phasetypeR_SFS.html">Using PhaseTypeR for the site frequency spectrum</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rivasiker/PhaseTypeR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="a3_phasetypeR_SFS_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using PhaseTypeR for the site frequency spectrum</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rivasiker/PhaseTypeR/blob/HEAD/vignettes/a3_phasetypeR_SFS.Rmd" class="external-link"><code>vignettes/a3_phasetypeR_SFS.Rmd</code></a></small>
      <div class="hidden name"><code>a3_phasetypeR_SFS.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we recreate the figures from the paper by Asger Hobolth, Mogens Bladt and Lars Nørvang Andersen entitled “Multivariate phase-type theory for the site frequency spectrum” (<a href="https://arxiv.org/abs/2101.04941" class="external-link uri">https://arxiv.org/abs/2101.04941</a>). This vignette is only intended to illustrate how to reproduce the figures of the article. If you are looking for a more in-depth explanation on how to use the  package for population genetics, please visit <a href="a2_pop_gen_iker.html">this vignette</a> instead.</p>
<p>For reproducibility of the simulations below, we first fix the seed of the random generator. We then load the  package and auxiliary functions, which we will need below. The auxiliary functions are included at <a href="#aux">the end of this vignette</a>, and they can be copy-pasted into a source file if needed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## You can install the dependencies for this vignette by running the following:</span></span>
<span><span class="co"># install.packages('expm')</span></span>
<span><span class="co"># install.packages('partitions')</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rivasiker.github.io/PhaseTypeR/" class="external-link">PhaseTypeR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://R-Forge.R-project.org/projects/expm/" class="external-link">expm</a></span><span class="op">)</span></span>
<span><span class="co"># source('auxiliary_functions.R')</span></span></code></pre></div>
<div class="section level2">
<h2 id="figure-1">Figure 1<a class="anchor" aria-label="anchor" href="#figure-1"></a>
</h2>
<p>Consider first, the left figure of Figure 1. This figure displays the coefficients of the site frequency spectrum for different unbiased estimators of the mutation rate <span class="math inline">\(\theta\)</span>. The coefficients of the H, L, Watterson’s, pairwise and singleton estimators are given Section 1.1 of Hobolth <span class="citation">(<a href="#ref-asgertemp2020" role="doc-biblioref">2021</a>)</span>. The coefficients of the BLUE estimator are given by <span class="math display">\[\begin{eqnarray}
  \hat{\mathbf{c}}=
  \frac{\mathbf{\Lambda}^{-1}\mathbf{v}}{\mathbf{v}^{\ast}\;\mathbf{\Lambda}^{-1}\mathbf{v}}.
\end{eqnarray}\]</span> where <span class="math inline">\(\mathbf{v}= (1,1/2,\dots,1/(n-1))^\ast\)</span> and <span class="math inline">\(\mathbf{\Lambda}\)</span> is the covariance matrix of the site frequency spectrum, which, as described in Section 5 in Hobolth <span class="citation">(<a href="#ref-asgertemp2020" role="doc-biblioref">2021</a>)</span> can be calculated in terms of the mean <span class="math inline">\(\mathbf{\mu}\)</span> and covariance matrix <span class="math inline">\(\mathbf{\Sigma}\)</span> of the underlying block counting process <span class="math display">\[\begin{align}
\mathbf{\Lambda}= \mbox{Var}\mathbf{Z}= \left(\frac{\theta}{2}\right)^2 \mathbf{\Sigma}+ \frac{\theta}{2} \mbox{diag}(\mathbf{\mu})
\end{align}\]</span></p>
<p>The latter two are easily calculated numerically using the  package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">=</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># Generate the block counting process for n = 10 as a </span></span>
<span><span class="co"># phase-type distribution. The resulting object will be of class </span></span>
<span><span class="co"># "mult_cont_phase_type"  with subintensity matrix "subint_mat" </span></span>
<span><span class="co"># and state space/reward matrix "reward_mat".</span></span>
<span></span>
<span><span class="va">ph_bcp</span> <span class="op">&lt;-</span> <span class="fu">block_counting_process</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">bmu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mean.html">mean</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">)</span> <span class="co">#bmu = bold mu</span></span>
<span><span class="va">bSigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/var.html">var</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">)</span> <span class="co">#bSigma = bold Sigma</span></span></code></pre></div>
<p>Using these two quantities, the coefficients are calculated below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thetaVec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">100</span><span class="op">)</span> <span class="co">#Vector theta values for Figure 1</span></span>
<span><span class="va">bv</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#The vector bold v defined above </span></span>
<span></span>
<span><span class="co">##BLUE Estimators</span></span>
<span></span>
<span><span class="va">coef_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">thetaVec</span><span class="op">)</span>,<span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">thetaVec</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">theta</span> <span class="op">=</span> <span class="va">thetaVec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">bLambda</span><span class="op">=</span><span class="op">(</span><span class="va">theta</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">*</span><span class="va">bSigma</span> <span class="op">+</span> <span class="op">(</span><span class="va">theta</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span> <span class="va">bmu</span> <span class="op">)</span></span>
<span>  <span class="va">coef_matrix</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">bLambda</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">bv</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bv</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">bLambda</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">bv</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">##  Watterson's estimator</span></span>
<span><span class="va">xWatt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bv</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">bv</span><span class="op">)</span></span>
<span><span class="co">##-------------------------------------------------------------</span></span>
<span><span class="co">## Singleton estimator</span></span>
<span><span class="va">xsngltns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bv</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##-------------------------------------------------------------</span></span>
<span><span class="co">## Pairwise difference estimator</span></span>
<span><span class="va">xpair</span> <span class="op">&lt;-</span> <span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span><span class="op">*</span><span class="op">(</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span> <span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span></span>
<span><span class="co">##-------------------------------------------------------------</span></span>
<span><span class="co">## H estimator</span></span>
<span><span class="va">xH</span> <span class="op">&lt;-</span> <span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span><span class="fl">2</span><span class="op">/</span><span class="va">n</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">##-------------------------------------------------------------</span></span>
<span><span class="co">## L estimator</span></span>
<span><span class="va">xL</span> <span class="op">&lt;-</span> <span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">##---------------------------------------------------------------</span></span>
<span><span class="co">## Plot the coefficients of the 5 different estimators (W,S,P,H,L)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">xWatt</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="fl">2</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"black"</span>,lwd<span class="op">=</span><span class="fl">2</span>,type<span class="op">=</span><span class="st">"l"</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span><span class="op">)</span>,</span>
<span>     xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>,ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">c</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,cex.lab<span class="op">=</span><span class="fl">1.5</span>,lty<span class="op">=</span><span class="fl">2</span>,las<span class="op">=</span><span class="fl">1</span>,cex.axis<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>,col<span class="op">=</span><span class="st">"gray"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">xsngltns</span>,col<span class="op">=</span><span class="st">"black"</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">xpair</span>,col<span class="op">=</span><span class="st">"black"</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">4</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">xH</span>,col<span class="op">=</span><span class="st">"black"</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">5</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">xL</span>,col<span class="op">=</span><span class="st">"black"</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">6</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">thetaVec</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">xhat</span> <span class="op">=</span> <span class="va">coef_matrix</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">xhat</span>,type<span class="op">=</span><span class="st">"l"</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="va">xhat</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">theta</span><span class="op">==</span><span class="fu">.</span><span class="op">(</span><span class="va">thetaVec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,pos<span class="op">=</span><span class="fl">4</span>,cex<span class="op">=</span><span class="fl">1.0</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">txtVec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Watterson"</span>,<span class="st">"Singleton"</span>,<span class="st">"Pairwise"</span>,<span class="st">"H"</span>,<span class="st">"L"</span>,<span class="st">"BLUE"</span><span class="op">)</span></span>
<span><span class="va">ltyVec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="va">txtVec</span><span class="op">[</span><span class="va">indx</span><span class="op">]</span>,lty<span class="op">=</span><span class="va">ltyVec</span><span class="op">[</span><span class="va">indx</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="a3_phasetypeR_SFS_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The right figure in Figure 1 displays the variances as a function of <span class="math inline">\(\theta\)</span> - these can be calculated as <span class="math inline">\(\mathbf{c}^\ast \mathbf{\Lambda}\mathbf{c}= \mathbf{c}^\ast \mathbf{\Lambda}(\theta) \mathbf{c}\)</span>, where <span class="math inline">\(\mathbf{c}\)</span> are the coefficients calculated above, and <span class="math inline">\(\mathbf{\Lambda}(\theta)\)</span> is the covariance of the site frequency spectrum as above.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thetaVec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">2.5</span>,by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">ntheta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">thetaVec</span><span class="op">)</span></span>
<span><span class="va">vrW</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ntheta</span><span class="op">)</span> ; <span class="va">vrS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ntheta</span><span class="op">)</span> ; <span class="va">vrP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ntheta</span><span class="op">)</span></span>
<span><span class="va">vrH</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ntheta</span><span class="op">)</span> ; <span class="va">vrL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ntheta</span><span class="op">)</span> ; <span class="va">vrMVUE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ntheta</span><span class="op">)</span> </span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">ntheta</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tht</span> <span class="op">&lt;-</span> <span class="va">thetaVec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">bLambda</span><span class="op">=</span><span class="op">(</span><span class="va">tht</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span><span class="op">*</span><span class="va">bSigma</span> <span class="op">+</span> <span class="op">(</span><span class="va">tht</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span> <span class="va">bmu</span> <span class="op">)</span></span>
<span>  <span class="va">xhat</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">bLambda</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bv</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">bLambda</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bv</span><span class="op">)</span></span>
<span>  <span class="va">vrMVUE</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">xhat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bLambda</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">xhat</span></span>
<span>  <span class="va">vrW</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">xWatt</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bLambda</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">xWatt</span></span>
<span>  <span class="va">vrS</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">xsngltns</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bLambda</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">xsngltns</span></span>
<span>  <span class="va">vrP</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">xpair</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bLambda</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">xpair</span></span>
<span>  <span class="va">vrH</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">xH</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bLambda</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">xH</span></span>
<span>  <span class="va">vrL</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">xL</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bLambda</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">xL</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">thetaVec</span>,<span class="va">vrMVUE</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">thetaVec</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>,ylab<span class="op">=</span><span class="st">"Variance for estimator"</span>,cex.lab<span class="op">=</span><span class="fl">1.5</span>,las<span class="op">=</span><span class="fl">1</span>,cex.axis<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">thetaVec</span>,<span class="va">vrW</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">thetaVec</span>,<span class="va">vrS</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">thetaVec</span>,<span class="va">vrP</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">4</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">thetaVec</span>,<span class="va">vrH</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">5</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">thetaVec</span>,<span class="va">vrL</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">6</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,<span class="va">txtVec</span><span class="op">[</span><span class="va">indx</span><span class="op">]</span>,lty<span class="op">=</span><span class="va">ltyVec</span><span class="op">[</span><span class="va">indx</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="a3_phasetypeR_SFS_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="figure-2">Figure 2<a class="anchor" aria-label="anchor" href="#figure-2"></a>
</h2>
<p>Here, we numerically invert the characteristic function of the numerator of Tajima’s <span class="math inline">\(D\)</span> and compare to simulated values. First, we obtain the rate-matrix and state space for the block counting process. First, we simulate using Theorem 3.1 in Asger <span class="citation">(<a href="#ref-asgertemp2020" role="doc-biblioref">2021</a>)</span>, from which it follows that the site frequency spectrum can be simulated by first sampling a random variate from the appropriate block counting process, and letting the entries of this variate be the rates of independent Poisson random variables. First, we obtain the block counting process for <span class="math inline">\(n=4\)</span></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="co"># create rate-matrix and state space for block counting process</span></span>
<span><span class="va">ph_bcp</span> <span class="op">&lt;-</span> <span class="fu">block_counting_process</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Obtain sub-intensity matrix</span></span>
<span><span class="va">subintensity_matrix</span> <span class="op">&lt;-</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span></span>
<span><span class="va">rew_mat</span> <span class="op">&lt;-</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span></span></code></pre></div>
<p>Next, we simulate random site frequency spectra.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fl">1e4</span></span>
<span><span class="va">ph_mv_sim_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="../reference/MPH_functions.html">rMPH</a></span><span class="op">(</span><span class="va">R</span>,<span class="va">ph_bcp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co">#lambda = theta/2</span></span>
<span><span class="va">ph_counts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ph_mv_sim_obj</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ph_mv_sim_obj</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">R</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ph_counts</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="va">lambda</span><span class="op">*</span><span class="va">ph_mv_sim_obj</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The numerator of Tajima’s <span class="math inline">\(D\)</span> is <span class="math inline">\(\hat{\theta}_{\pi}-\hat{\theta}_{\rm W}\)</span>, so the coefficient vector <span class="math inline">\(\mathbf{c} (c_i)\)</span> is given by</p>
<p><span class="math display">\[
c_i = \frac{1}{\binom{n}{2}} i (n-i) - \frac{1}{\sum_{i=1}^{n-1} \frac{1}{i}} \, ,
\]</span></p>
<p>which is implemented below:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bc</span> <span class="op">=</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For numeric reasons, we scale the coefficients by 1000 and re-scale later</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">bc</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">*</span><span class="va">bc</span></span></code></pre></div>
<p>According to equation (48) and (49) of Hobolth <span class="citation">(<a href="#ref-asgertemp2020" role="doc-biblioref">2021</a>)</span>, the characteristic function is obtained as</p>
<p><span class="math display">\[
\phi(t) = G(\mathrm{e}^{\mathrm{i}t})
\]</span> where <span class="math display">\[\begin{align*}
  G(z) = 
  \mbox{Exp}[z^{\mathbf{c}^\ast \mathbf{xi}}] = 
  \mbox{Exp}[z^{c_1 \xi_1} z^{c_2 \xi_2} \dots z^{c_{n-1} \xi_{n-1}}] =
  \mathbf{e}_1^\ast \left( \lambda \Delta[\mathbf{A}(z^\mathbf{c}- \mathbf{e})] +\mathbf{T}\right)^{-1} \mathbf{T}\mathbf{e}
  =   \mathbf{e}_1^\ast \left( \mathbf{S}+ \lambda \Delta[\mathbf{A}(z^\mathbf{c}] \right)^{-1} \mathbf{T}\mathbf{e}
\end{align*}\]</span> where <span class="math inline">\(\mathbf{T},\mathbf{A}\)</span> being respectively the sub-intensity matrix and reward matrix of the block counting process, <span class="math inline">\(\mathbf{e}= (1,1,\dots,1)^\ast\)</span> and <span class="math inline">\(\mathbf{S}= \mathbf{T}- \lambda \Delta \mathbf{A}\mathbf{e}\)</span>.</p>
<p>The next snippet implements the <span class="math inline">\(\phi\)</span>-function</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">themean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean.html">mean</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">)</span><span class="op">*</span><span class="va">bc</span><span class="op">)</span> <span class="co">#the mean of the linear combination (should be 0)</span></span>
<span><span class="va">bT</span> <span class="op">&lt;-</span> <span class="va">subintensity_matrix</span> <span class="co">#bold T</span></span>
<span><span class="va">bA</span> <span class="op">&lt;-</span> <span class="va">rew_mat</span> <span class="co">#bold A</span></span>
<span><span class="va">bS</span> <span class="op">&lt;-</span> <span class="va">bT</span> <span class="op">-</span> <span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">bA</span><span class="op">)</span><span class="op">)</span> <span class="co">#bold S</span></span>
<span><span class="va">be</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bT</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">#be = (1,1,...,1)^T</span></span>
<span><span class="va">beone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bT</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>;<span class="va">beone</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fl">1</span> <span class="co">#(1,0,...,0)</span></span>
<span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1i</span><span class="op">*</span><span class="va">themean</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">beone</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">bS</span><span class="op">+</span><span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bA</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">1i</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">^</span><span class="va">bc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">bT</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">be</span></span></code></pre></div>
<p>Finally, we approximate the CDF and re-scale</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">appvals</span> <span class="op">&lt;-</span> <span class="fu">ApproxCDF</span><span class="op">(</span><span class="va">phi</span>,H <span class="op">=</span> <span class="fl">1e5</span>,eta<span class="op">=</span><span class="fl">0.0001</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">res</span>,<span class="fl">1.5</span><span class="op">*</span><span class="va">res</span><span class="op">)</span>,smoothe<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xvals</span> <span class="op">&lt;-</span> <span class="va">appvals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">yvals</span> <span class="op">&lt;-</span> <span class="va">appvals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#rescale</span></span>
<span><span class="va">bc2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">bc</span></span>
<span><span class="va">xvals2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">xvals</span></span>
<span><span class="va">themean2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">themean</span></span>
<span><span class="va">centered_sim2</span> <span class="op">&lt;-</span> <span class="va">ph_counts</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">bc2</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">themean2</span><span class="op">)</span></span>
<span><span class="va">ecdfobj2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ecdf.html" class="external-link">ecdf</a></span><span class="op">(</span><span class="va">centered_sim2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xvals2</span>,<span class="va">yvals</span>,type<span class="op">=</span><span class="st">"l"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1.5</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">""</span>,las<span class="op">=</span><span class="fl">1</span>,ylab<span class="op">=</span><span class="st">"Cumulative distribution function"</span>,cex.axis<span class="op">=</span><span class="fl">1.5</span>,cex.lab<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ecdfobj2</span>,col<span class="op">=</span><span class="st">"blue"</span>,col.01line <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xvals2</span>,<span class="va">yvals</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.25</span>, <span class="fl">0.025</span>, x1 <span class="op">=</span> <span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fl">0.025</span><span class="op">&lt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">0.025</span>,lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span><span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fl">0.025</span><span class="op">&lt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="op">-</span><span class="fl">1</span>, x1 <span class="op">=</span> <span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fl">0.025</span><span class="op">&lt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">0.025</span>,lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.25</span>, <span class="fl">0.975</span>, x1 <span class="op">=</span> <span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">&gt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">0.975</span>,lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span><span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">&lt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="op">-</span><span class="fl">1</span>, x1 <span class="op">=</span> <span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">&gt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">0.975</span>,lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span><span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fl">0.025</span><span class="op">&lt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="fl">0</span>, x1 <span class="op">=</span> <span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">&gt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">0</span>,lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fl">0.025</span><span class="op">&lt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,<span class="op">-</span><span class="fl">0.035</span>,pch<span class="op">=</span><span class="fl">17</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">&gt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,<span class="op">-</span><span class="fl">0.035</span>,pch<span class="op">=</span><span class="fl">17</span><span class="op">)</span></span></code></pre></div>
<p><img src="a3_phasetypeR_SFS_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Next, we run the above code with <span class="math inline">\(n=8\)</span>.</p>
<p><img src="a3_phasetypeR_SFS_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="figure-5">Figure 5<a class="anchor" aria-label="anchor" href="#figure-5"></a>
</h2>
<p>In this section we recreate the bottom two sub-figures of Figure 4, and first we consider the bottom left figure, which displays the CDFs of the <span class="math inline">\(i\)</span>-ton branch-length for <span class="math inline">\(i = 1,2,3,4\)</span>. As described in Section 3, these branch-lengths all have (possibly defective) <span class="math inline">\(PH\)</span> distributions, whose sub-intensity matrix (and possible defect) can be calculated from the sub-intensity matrix and state-space of the block-counting process, so we first compute these two objects:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="va">ph_bcp</span> <span class="op">&lt;-</span> <span class="fu">block_counting_process</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="va">subintensity_matrix</span> <span class="op">&lt;-</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span></span>
<span><span class="va">rew_mat</span> <span class="op">&lt;-</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span></span></code></pre></div>
<p>The reward matrix (which also represents the state-space of the block-counting process) is</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rew_mat</span></span></code></pre></div>
<pre><code><span><span class="co">##      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">## [1,]    5    0    0    0</span></span>
<span><span class="co">## [2,]    3    1    0    0</span></span>
<span><span class="co">## [3,]    2    0    1    0</span></span>
<span><span class="co">## [4,]    1    2    0    0</span></span>
<span><span class="co">## [5,]    1    0    0    1</span></span>
<span><span class="co">## [6,]    0    1    1    0</span></span></code></pre>
<p>As we see, the first column of the state-space matrix, <span class="math inline">\(\mathbf{r}= (5,3,2,1,1,0)^\ast\)</span>, then corresponds to the rewards which give rise to the singleton branch-lengths, which can then be generated as</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ph</span> <span class="op">=</span> <span class="fu"><a href="../reference/generator_functions.html">PH</a></span><span class="op">(</span><span class="va">subintensity_matrix</span><span class="op">)</span></span>
<span><span class="va">ph_rew_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reward_phase_type.html">reward_phase_type</a></span><span class="op">(</span><span class="va">ph</span>, <span class="va">rew_mat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The code below generates the phase-type distribution of the <span class="math inline">\(i\)</span>-ton branches and their CDFs using the standard results for phase-type distributions (see e.g. Section 2.2 in Hobolth <span class="citation">(<a href="#ref-asgertemp2020" role="doc-biblioref">2021</a>)</span>)</p>
<p><span class="math display">\[
1 - F(t) = \mbox{Prob}(\tau&gt;t) = 1- \mathbf{e}_1 e^{\mathbf{S}t}\mathbf{e}, 
\]</span> The code below plots the four distributions functions:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span>, type<span class="op">=</span><span class="st">"n"</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"t"</span>,ylab<span class="op">=</span><span class="st">"Cumulative distribution function"</span>,cex.lab<span class="op">=</span><span class="fl">1.5</span>,</span>
<span>     main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"Branch length distributions for i-tons with sample size"</span><span class="op">~</span><span class="va">n</span><span class="op">==</span><span class="fu">.</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,las<span class="op">=</span><span class="fl">1</span>,cex.axis<span class="op">=</span><span class="fl">1.5</span>,cex.main<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ph_rew_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reward_phase_type.html">reward_phase_type</a></span><span class="op">(</span><span class="va">ph</span>,<span class="va">rew_mat</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">be</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">init_probs</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">abstime</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fl">1</span> <span class="op">-</span> <span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">init_probs</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/pkg/expm/man/expm.html" class="external-link">expm</a></span><span class="op">(</span><span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">subint_mat</span><span class="op">*</span><span class="va">u</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">be</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">abstime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Vectorize.html" class="external-link">Vectorize</a></span><span class="op">(</span><span class="va">abstime</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="va">abstime</span>,lty<span class="op">=</span><span class="va">i</span>,add<span class="op">=</span><span class="cn">TRUE</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"singleton"</span>,<span class="st">"doubleton"</span>,<span class="st">"tripleton"</span>,<span class="st">"quardrupleton"</span><span class="op">)</span>,</span>
<span>       lty<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1.6</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="a3_phasetypeR_SFS_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>The the bottom right plot of Figure 4, we find the point probabilities of <span class="math inline">\(i\)</span> mutations <span class="math inline">\(i=1,\dots,4\)</span> corresponding to phase-type distributions of the bottom left figure. These are easily computed using Theorem 2.3 which in this case has the interpretation, that adding mutations to branches whose length is <span class="math inline">\(PH\)</span>-distributed, gives a <span class="math inline">\(DPH\)</span> distribution, whose sub-transition matrix is given by</p>
<p><span class="math display">\[\begin{equation}
   \mathbf{M}=\Big(\mathbf{I}-\frac{2}{\theta} \mathbf{S}\Big)^{-1}.  \tag{$\spadesuit$}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\mathbf{S}\)</span> is the sub-transition matrix of the underlying phase-type distribution.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span>, type<span class="op">=</span><span class="st">"n"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,las<span class="op">=</span><span class="fl">1</span>,xlab<span class="op">=</span><span class="st">"Number of mutations"</span>,ylab<span class="op">=</span><span class="st">"Probability"</span>,</span>
<span>     main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"Probability of mutations for"</span><span class="op">~</span><span class="va">theta</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>,cex.lab<span class="op">=</span><span class="fl">1.5</span>,cex.main<span class="op">=</span><span class="fl">1.4</span>,cex.axis<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> </span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ph_rew_obj</span><span class="op">=</span><span class="fu"><a href="../reference/reward_phase_type.html">reward_phase_type</a></span><span class="op">(</span><span class="va">ph</span>, <span class="va">rew_mat</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">bS</span> <span class="op">&lt;-</span> <span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">subint_mat</span></span>
<span>  <span class="va">bM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bS</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">bS</span><span class="op">)</span></span>
<span>  <span class="va">bpi</span> <span class="op">&lt;-</span> <span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">init_probs</span></span>
<span>  <span class="va">be</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bS</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">bm</span> <span class="op">&lt;-</span> <span class="va">be</span> <span class="op">-</span> <span class="va">bM</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">be</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,<span class="fl">1</span>,<span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">bpi</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="op">(</span><span class="va">bM</span><span class="op"><a href="https://rdrr.io/pkg/expm/man/matpow.html" class="external-link">%^%</a></span><span class="va">i</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">bm</span><span class="op">)</span></span>
<span>  <span class="va">probs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">probs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">defect</span> <span class="co">#note we have to take the possible defect into account</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span>,<span class="va">probs</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span>,<span class="va">probs</span>,lty<span class="op">=</span><span class="va">i</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"singleton"</span>,<span class="st">"doubleton"</span>,<span class="st">"tripleton"</span>,<span class="st">"quardrupleton"</span><span class="op">)</span>,</span>
<span>       lty<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1.5</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="a3_phasetypeR_SFS_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="figure-7">Figure 7<a class="anchor" aria-label="anchor" href="#figure-7"></a>
</h2>
<p>Figure 6 displays the point probabilities of the three integer–weighted estimators for <span class="math inline">\(\theta\)</span> <span class="math inline">\((\hat{\theta}_{\pi}, \hat{\theta}_H)\)</span> and <span class="math inline">\(\hat{\theta}_L\)</span> for <span class="math inline">\(n=4\)</span> and <span class="math inline">\(n=6\)</span>. First, we consider the left sub-figure, i.e. <span class="math inline">\(n=4\)</span>. The three estimators are all integer-weighted versions of the site frequency spectrum, i.e., of the form <span class="math inline">\(\mathbf{a}^\ast \mathbf{xi}= a_1 \xi_1 + a_2 \xi_2 + \dots + a_{n-1} \xi_{n-1}\)</span>, where the <span class="math inline">\(a_i\)</span>s are integers. As described in Section 4 of Hobolth <span class="citation">(<a href="#ref-asgertemp2020" role="doc-biblioref">2021</a>)</span>, these estimators have a <span class="math inline">\(DPH\)</span> distribution, whose sub-transition matrix is constructed using the entries of (<span class="math inline">\(\spadesuit\)</span>), so we first, calculate the latter:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">ph_bcp</span> <span class="op">&lt;-</span> <span class="fu">block_counting_process</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="va">subintensity_matrix</span> <span class="op">&lt;-</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span></span>
<span><span class="va">rew_mat</span> <span class="op">&lt;-</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span></span>
<span></span>
<span><span class="va">ph</span> <span class="op">=</span> <span class="fu"><a href="../reference/generator_functions.html">PH</a></span><span class="op">(</span><span class="va">subintensity_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The reward vector is the rows sums of the state space matrix</span></span>
<span></span>
<span><span class="va">ph_rew_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reward_phase_type.html">reward_phase_type</a></span><span class="op">(</span><span class="va">ph</span>, <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">rew_mat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bS</span> <span class="op">&lt;-</span> <span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">subint_mat</span></span>
<span></span>
<span><span class="va">bM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bS</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">2</span><span class="op">/</span><span class="va">theta</span><span class="op">)</span><span class="op">*</span><span class="va">bS</span><span class="op">)</span></span></code></pre></div>
<p>Next, we define the three <span class="math inline">\(\mathbf{a}\)</span> vectors of coefficients. These are <span class="math inline">\((1,2,3)\)</span> , <span class="math inline">\((3,4,3)\)</span> and <span class="math inline">\((1,4,9)\)</span> for <span class="math inline">\((\hat{\theta}_L)\)</span>,<span class="math inline">\((\hat{\theta}_{\pi})\)</span> and <span class="math inline">\((\hat{\theta}_{H})\)</span> respectively.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">baMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,<span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="va">n</span><span class="op">-</span><span class="fl">1</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">baMat</span></span></code></pre></div>
<pre><code><span><span class="co">##      [,1] [,2] [,3]</span></span>
<span><span class="co">## [1,]    1    2    3</span></span>
<span><span class="co">## [2,]    3    4    3</span></span>
<span><span class="co">## [3,]    1    4    9</span></span></code></pre>
<p>The construction of the DPH-representation is described in Section 4 of Hobolth <span class="citation">(<a href="#ref-asgertemp2020" role="doc-biblioref">2021</a>)</span> and is implemented in the function , which is invoked in the code-snippet below.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">len</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span></span>
<span><span class="va">probsMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="va">len</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i_outer</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ba</span> <span class="op">&lt;-</span> <span class="va">baMat</span><span class="op">[</span><span class="va">i_outer</span>,<span class="op">]</span> <span class="co">#This is the current a-vector</span></span>
<span>  <span class="va">DPH_obj</span> <span class="op">&lt;-</span> <span class="fu">DPHrep</span><span class="op">(</span><span class="va">bM</span>,<span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span>,<span class="va">ba</span><span class="op">)</span></span>
<span>  <span class="va">bMt</span> <span class="op">&lt;-</span> <span class="va">DPH_obj</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sizes_of_blocks</span> <span class="op">&lt;-</span> <span class="va">DPH_obj</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">beone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bMt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">beone</span><span class="op">[</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> </span>
<span>  <span class="va">be</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bMt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">bmt</span> <span class="op">&lt;-</span> <span class="va">be</span> <span class="op">-</span> <span class="va">bMt</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">be</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">len</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">len</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">probs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">beone</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="op">(</span><span class="va">bMt</span><span class="op"><a href="https://rdrr.io/pkg/expm/man/matpow.html" class="external-link">%^%</a></span><span class="op">(</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">bmt</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">probsMat</span><span class="op">[</span><span class="va">i_outer</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">probs</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#Finally, plot the figures</span></span>
<span><span class="va">main.txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"Integer-weighted SFS distributions for"</span><span class="op">~</span><span class="va">n</span> <span class="op">==</span> <span class="fu">.</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="st">"dashed"</span>,pch<span class="op">=</span><span class="fl">19</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">"Weighted SFS"</span>,ylab<span class="op">=</span><span class="st">"Probability"</span>,</span>
<span>     main<span class="op">=</span><span class="va">main.txt</span>,cex.main<span class="op">=</span><span class="fl">1.4</span>,cex.lab<span class="op">=</span><span class="fl">1.5</span>,las<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span>,cex.axis<span class="op">=</span><span class="fl">1.20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,type<span class="op">=</span><span class="st">"p"</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="st">"dotted"</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"p"</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="st">"solid"</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"p"</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">"gray"</span><span class="op">)</span></span>
<span><span class="va">txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"mean"</span><span class="op">~</span><span class="va">theta</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">txt</span>,pos<span class="op">=</span><span class="fl">2</span>,cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pairwise"</span>,<span class="st">"H"</span>,<span class="st">"L"</span><span class="op">)</span>,lwd<span class="op">=</span><span class="fl">2</span>,</span>
<span>       lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dotted"</span>,<span class="st">"solid"</span>,<span class="st">"dashed"</span><span class="op">)</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="a3_phasetypeR_SFS_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>The figure for <span class="math inline">\(n=6\)</span> is created in a similar fashion</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">ph_bcp</span> <span class="op">&lt;-</span> <span class="fu">block_counting_process</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="va">subintensity_matrix</span> <span class="op">&lt;-</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span></span>
<span><span class="va">rew_mat</span> <span class="op">&lt;-</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span></span>
<span></span>
<span><span class="va">ph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generator_functions.html">PH</a></span><span class="op">(</span><span class="va">subintensity_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The reward vector is the rows sums of the state space matrix</span></span>
<span></span>
<span><span class="va">ph_rew_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reward_phase_type.html">reward_phase_type</a></span><span class="op">(</span><span class="va">ph</span>, <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">rew_mat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bS</span> <span class="op">&lt;-</span> <span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">subint_mat</span></span>
<span></span>
<span><span class="va">bM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bS</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">2</span><span class="op">/</span><span class="va">theta</span><span class="op">)</span><span class="op">*</span><span class="va">bS</span><span class="op">)</span></span>
<span></span>
<span><span class="va">baMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,<span class="va">n</span><span class="op">-</span><span class="fl">3</span>,<span class="va">n</span><span class="op">-</span><span class="fl">1</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">len</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span></span>
<span><span class="va">probsMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="va">len</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i_outer</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ba</span> <span class="op">&lt;-</span> <span class="va">baMat</span><span class="op">[</span><span class="va">i_outer</span>,<span class="op">]</span> <span class="co">#This is the current a-vector</span></span>
<span>  <span class="va">DPH_obj</span> <span class="op">&lt;-</span> <span class="fu">DPHrep</span><span class="op">(</span><span class="va">bM</span>,<span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span>,<span class="va">ba</span><span class="op">)</span></span>
<span>  <span class="va">bMt</span> <span class="op">&lt;-</span> <span class="va">DPH_obj</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sizes_of_blocks</span> <span class="op">&lt;-</span> <span class="va">DPH_obj</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">beone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bMt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">beone</span><span class="op">[</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> </span>
<span>  <span class="va">be</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bMt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">bmt</span> <span class="op">&lt;-</span> <span class="va">be</span> <span class="op">-</span> <span class="va">bMt</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">be</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">len</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">len</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">probs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">beone</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="op">(</span><span class="va">bMt</span><span class="op"><a href="https://rdrr.io/pkg/expm/man/matpow.html" class="external-link">%^%</a></span><span class="op">(</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">bmt</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">probsMat</span><span class="op">[</span><span class="va">i_outer</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">probs</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">main.txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"Integer-weighted SFS distributions for"</span><span class="op">~</span><span class="va">n</span><span class="op">==</span><span class="fu">.</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="st">"dashed"</span>,pch<span class="op">=</span><span class="fl">19</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">"Weighted SFS"</span>,ylab<span class="op">=</span><span class="st">"Probability"</span>,</span>
<span>     main<span class="op">=</span><span class="va">main.txt</span>,cex.main<span class="op">=</span><span class="fl">1.4</span>,cex.lab<span class="op">=</span><span class="fl">1.5</span>,las<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span>,cex.axis<span class="op">=</span><span class="fl">1.20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,type<span class="op">=</span><span class="st">"p"</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="st">"dotted"</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"p"</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="st">"solid"</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"p"</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">"gray"</span><span class="op">)</span></span>
<span><span class="va">txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"mean"</span><span class="op">~</span><span class="va">theta</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">txt</span>,pos<span class="op">=</span><span class="fl">2</span>,cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pairwise"</span>,<span class="st">"H"</span>,<span class="st">"L"</span><span class="op">)</span>,lwd<span class="op">=</span><span class="fl">2</span>,</span>
<span>       lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dotted"</span>,<span class="st">"solid"</span>,<span class="st">"dashed"</span><span class="op">)</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="a3_phasetypeR_SFS_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="figure-8">Figure 8<a class="anchor" aria-label="anchor" href="#figure-8"></a>
</h2>
<p>The last figure compares the CDF of the the BLUE estimator for <span class="math inline">\(\theta = 1\)</span> and <span class="math inline">\(\theta = 10\)</span> to Watterson’s estimator and the pairwise estimator. The code is given below without further comments, as it re-uses the code snippets above with minor modifications.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">ph_bcp</span> <span class="op">&lt;-</span> <span class="fu">block_counting_process</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">ph_mv_sim_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="../reference/MPH_functions.html">rMPH</a></span><span class="op">(</span><span class="va">R</span>,<span class="va">ph_bcp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">19</span><span class="op">)</span></span>
<span><span class="va">ph_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ph_mv_sim_obj</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ph_mv_sim_obj</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">R</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ph_counts</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="va">lambda</span><span class="op">*</span><span class="va">ph_mv_sim_obj</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">subintensity_matrix</span> <span class="op">&lt;-</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span></span>
<span></span>
<span><span class="va">rew_mat</span> <span class="op">&lt;-</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span></span>
<span></span>
<span><span class="va">bc</span> <span class="op">&lt;-</span> <span class="va">coef_matrix</span><span class="op">[</span><span class="fl">4</span>,<span class="op">]</span> <span class="co">#coef_matrix was generated above, its rows correspond to the entries of thetavec, fourth entry is theta = 10</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">bc</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">*</span><span class="va">bc</span></span>
<span><span class="co">#compute characteristic function</span></span>
<span><span class="va">themean</span> <span class="op">&lt;-</span> <span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean.html">mean</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">)</span><span class="op">*</span><span class="va">bc</span><span class="op">)</span> <span class="co">#the mean of the linear combination</span></span>
<span><span class="va">bT</span> <span class="op">&lt;-</span> <span class="va">subintensity_matrix</span> <span class="co">#bold T</span></span>
<span><span class="va">bA</span> <span class="op">&lt;-</span> <span class="va">rew_mat</span> <span class="co">#bold A</span></span>
<span><span class="va">bS</span> <span class="op">&lt;-</span> <span class="va">bT</span> <span class="op">-</span> <span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">bA</span><span class="op">)</span><span class="op">)</span> <span class="co">#bold S</span></span>
<span><span class="va">be</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bT</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">#bold one = (1,1,...,1)^T</span></span>
<span><span class="va">beone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bT</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>;<span class="va">beone</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fl">1</span> <span class="co">#(1,0,...,0)</span></span>
<span></span>
<span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1i</span><span class="op">*</span><span class="va">themean</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">beone</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">bS</span><span class="op">+</span><span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bA</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">1i</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">^</span><span class="va">bc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">bT</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">be</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co">#Invert numerically</span></span>
<span><span class="va">appvals</span> <span class="op">&lt;-</span> <span class="fu">ApproxCDF</span><span class="op">(</span><span class="va">phi</span>,H <span class="op">=</span> <span class="fl">1e5</span>,eta<span class="op">=</span><span class="fl">0.0001</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span><span class="op">*</span><span class="va">res</span>,<span class="fl">10</span><span class="op">*</span><span class="va">res</span><span class="op">)</span>,smoothe<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xvals</span> <span class="op">&lt;-</span> <span class="va">appvals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">yvals</span> <span class="op">&lt;-</span> <span class="va">appvals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">bc2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">bc</span></span>
<span><span class="va">xvals2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">xvals</span></span>
<span><span class="va">themean2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">themean</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co">#Compute point probabilities of Watterson's Theta for theta = 10</span></span>
<span></span>
<span><span class="va">ph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generator_functions.html">PH</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span><span class="op">)</span></span>
<span><span class="va">watter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reward_phase_type.html">reward_phase_type</a></span><span class="op">(</span><span class="va">ph</span>, <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="va">bM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">watter</span><span class="op">$</span><span class="va">subint_mat</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">lambda</span><span class="op">)</span><span class="op">*</span><span class="va">watter</span><span class="op">$</span><span class="va">subint_mat</span><span class="op">)</span></span>
<span><span class="va">bm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bM</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="va">bM</span><span class="op">)</span></span>
<span></span>
<span><span class="va">a1</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#"normalizing" constant, in Watterson's theta</span></span>
<span><span class="va">len</span> <span class="op">&lt;-</span> <span class="fl">250</span> <span class="co">#number of points to include</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">len</span><span class="op">)</span> </span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">len</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">out</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ph</span><span class="op">$</span><span class="va">init_probs</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="op">(</span><span class="va">bM</span><span class="op"><a href="https://rdrr.io/pkg/expm/man/matpow.html" class="external-link">%^%</a></span><span class="va">i</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">bm</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">wxt</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">10</span><span class="op">+</span><span class="va">a1</span><span class="op">*</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">len</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Possible values for  Watterson's Theta</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Pairwise estimator for theta = 10</span></span>
<span></span>
<span><span class="va">ba</span> <span class="op">&lt;-</span> <span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span><span class="op">*</span><span class="op">(</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span> <span class="op">)</span> <span class="co">#Coefficients of pair-wise estimator</span></span>
<span><span class="va">DPH_obj</span> <span class="op">&lt;-</span> <span class="fu">DPHrep</span><span class="op">(</span><span class="va">bM</span>,<span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span>,<span class="va">ba</span><span class="op">)</span></span>
<span><span class="va">bMt</span> <span class="op">&lt;-</span> <span class="va">DPH_obj</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">sizes_of_blocks</span> <span class="op">&lt;-</span> <span class="va">DPH_obj</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">beone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bMt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">beone</span><span class="op">[</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> </span>
<span><span class="va">be</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bMt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bmt</span> <span class="op">&lt;-</span> <span class="va">be</span> <span class="op">-</span> <span class="va">bMt</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">be</span></span>
<span></span>
<span><span class="va">len</span> <span class="op">=</span> <span class="fl">1e3</span></span>
<span></span>
<span></span>
<span><span class="co"># Running bMt - the bMt is pretty large, computing its matrix-powers in the naive way as above is time-consuming.</span></span>
<span><span class="va">probs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">len</span><span class="op">)</span></span>
<span><span class="va">run_bMT</span> <span class="op">&lt;-</span> <span class="va">beone</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">len</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">probs2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">run_bMT</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">bmt</span></span>
<span>  <span class="va">run_bMT</span> <span class="op">&lt;-</span> <span class="va">run_bMT</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">bMt</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">a1</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="co">#Normalizing constant of the pairwise estimator</span></span>
<span><span class="va">wx</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">10</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">a1</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">len</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xvals2</span>,<span class="va">yvals</span>,type<span class="op">=</span><span class="st">"l"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">""</span>,ylab<span class="op">=</span><span class="st">"Cumulative distribution function"</span>,cex.lab<span class="op">=</span><span class="fl">1.5</span>,las <span class="op">=</span> <span class="fl">1</span>,cex.axis<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/stepfun.html" class="external-link">stepfun</a></span><span class="op">(</span><span class="va">wx</span>,<span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">probs2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"red"</span>,do.points<span class="op">=</span><span class="cn">FALSE</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xvals2</span>,<span class="va">yvals</span>,type<span class="op">=</span><span class="st">"l"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">""</span>,ylab<span class="op">=</span><span class="st">""</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/stepfun.html" class="external-link">stepfun</a></span><span class="op">(</span><span class="va">wxt</span>,<span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">out</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span>,do.points<span class="op">=</span><span class="cn">FALSE</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BLUE"</span>,<span class="st">"Watterson"</span>,<span class="st">"Pairwise"</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1.6</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="a3_phasetypeR_SFS_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="aux">Auxiliary functions<a class="anchor" aria-label="anchor" href="#aux"></a>
</h2>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#'Numerical Approximation of characteristic function</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'\code{ApproxCDF} approximates the cdf F when given a characteristic function phi of a centered random variable, using the formula found in Waller (1995) with</span></span>
<span><span class="co">#'original reference to Bohman (1974). The procedure can be numerically unstable in the tails of the distribution, so</span></span>
<span><span class="co">#'only the center of the approximation is returned. Some simplifying approximations explained in "Numerical inversion of Laplace transform and characteristic function"</span></span>
<span><span class="co">#'are used. Note that phi should have a finite first moment.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'@param phi the characteristic function to be inverted</span></span>
<span><span class="co">#'@param H A total of 2H+1 values of F are approximated. By default H of these values are returned unless an interval is provided.</span></span>
<span><span class="co">#'@param eta A scaling paramter. By default equidistant points in the interval (-2*phi/eta,2*phi/(eta)) are approximated.</span></span>
<span><span class="co">#'@param xlim (optional) limits on the x-axis</span></span>
<span><span class="co">#'@param smoothe (optional) Should smoothing be used? If TRUE default weights of the function \code{simple_smoothe} are used. If an object of length &gt; 1 is provided,</span></span>
<span><span class="co">#'this will be passed to \code{simple_smoothe}</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'@examples</span></span>
<span><span class="co">#'phi &lt;- function(t) exp(-t^2/2)</span></span>
<span><span class="co">#'appvals=ApproxCDF(phi,H=1000,eta=0.5,xlim=c(-3,3))</span></span>
<span><span class="co">#'plot(appvals[[1]],appvals[[2]],type="l",lwd=2)</span></span>
<span><span class="co">#'lines(appvals[[1]],pnorm(appvals[[1]]),type="l",col="red")</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'phi &lt;- function(t) sqrt(2)*abs(t)*besselK(sqrt(2)*abs(t),1)</span></span>
<span><span class="co">#'appvals=ApproxCDF(phi,H=10000,eta=0.1,xlim=c(-3,3))</span></span>
<span><span class="co">#'plot(appvals[[1]],appvals[[2]],type="l",lwd=2)</span></span>
<span><span class="co">#'lines(appvals[[1]],pt(appvals[[1]],df=2),type="l",col="red")</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'@export</span></span>
<span></span>
<span></span>
<span><span class="va">ApproxCDF</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">phi</span>,<span class="va">H</span><span class="op">=</span><span class="fl">2000</span>,<span class="va">eta</span><span class="op">=</span><span class="fl">0.5</span>,<span class="va">xlim</span><span class="op">=</span><span class="cn">NULL</span>,<span class="va">smoothe</span><span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">z_vals</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">H</span><span class="op">)</span></span>
<span>  <span class="va">co</span> <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">H</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>  <span class="op">{</span></span>
<span>    <span class="va">z_vals</span><span class="op">[</span><span class="va">co</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span> <span class="fu">phi</span><span class="op">(</span><span class="va">eta</span><span class="op">*</span><span class="va">n</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">pi</span><span class="op">*</span><span class="fl">1i</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="co">#start at index 2 - the first value of z is 0</span></span>
<span>    <span class="va">co</span> <span class="op">=</span> <span class="va">co</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">yvals_pos</span><span class="op">=</span><span class="fl">0.5</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">H</span><span class="op">)</span><span class="op">/</span><span class="va">H</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html" class="external-link">Re</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fft.html" class="external-link">fft</a></span><span class="op">(</span><span class="va">z_vals</span>,inverse<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">yvals_neg</span><span class="op">=</span><span class="fl">0.5</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">H</span><span class="op">)</span><span class="op">/</span><span class="va">H</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html" class="external-link">Re</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fft.html" class="external-link">fft</a></span><span class="op">(</span><span class="va">z_vals</span>,inverse<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">xvals_pos</span> <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">H</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">eta</span><span class="op">*</span><span class="va">H</span><span class="op">)</span></span>
<span>  <span class="va">xvals_neg</span> <span class="op">=</span> <span class="op">-</span><span class="va">xvals_pos</span></span>
<span>  <span class="va">xvals_neg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">xvals_neg</span><span class="op">)</span></span>
<span>  <span class="va">yvals_neg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">yvals_neg</span><span class="op">)</span></span>
<span>  <span class="va">xvals</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xvals_neg</span>,<span class="va">xvals_pos</span><span class="op">)</span></span>
<span>  <span class="va">yvals</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">yvals_neg</span>,<span class="va">yvals_pos</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">xlim</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">indexes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">xvals</span><span class="op">&gt;</span><span class="va">xlim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">xvals</span><span class="op">&lt;</span><span class="va">xlim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">indexes</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">H</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span> <span class="op">(</span><span class="va">H</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">xvals</span> <span class="op">=</span> <span class="va">xvals</span><span class="op">[</span><span class="va">indexes</span><span class="op">]</span></span>
<span>  <span class="va">yvals</span> <span class="op">=</span> <span class="va">yvals</span><span class="op">[</span><span class="va">indexes</span><span class="op">]</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">smoothe</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">smoothe</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">yvals</span> <span class="op">=</span> <span class="fu">simple_smoothe</span><span class="op">(</span><span class="va">yvals</span>,<span class="va">smoothe</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">yvals</span> <span class="op">=</span> <span class="fu">simple_smoothe</span><span class="op">(</span><span class="va">yvals</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">xvals</span>,<span class="va">yvals</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Simple smoothing</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' \code{simple_smoothe} computes a simple moving weighted average of a input vector \code{x}. The weight vector must have an odd number of entries, and defaults to</span></span>
<span><span class="co">#' \code{c(0.1,0.20,0.4,0.20,0.1)}</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x input to be smoothed</span></span>
<span><span class="co">#' @param svec smoothing vector</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'@examples</span></span>
<span><span class="co">#'smoothed_yvals = simple_smoothe(yvals)</span></span>
<span><span class="co">#'smoothed_yvals = simple_smoothe(yvals,c(0.2,0.6,0.2))</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'@export</span></span>
<span></span>
<span></span>
<span><span class="va">simple_smoothe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">svec</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.20</span>,<span class="fl">0.4</span>,<span class="fl">0.20</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">svec</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span><span class="op">)</span>  <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Please provide an odd number of smoothing weigths"</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="va">out</span> <span class="op">=</span> <span class="va">x</span></span>
<span>  <span class="va">offset</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">svec</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">offset</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">-</span><span class="va">offset</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">out</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">(</span><span class="va">i</span><span class="op">-</span><span class="va">offset</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">i</span><span class="op">+</span><span class="va">offset</span><span class="op">)</span><span class="op">]</span><span class="op">*</span><span class="va">svec</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Construction of DPH-representation</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' \code{DPHrep} computes the representation of of a integer-linear-combination of the Site Frequency as a discrete phase-type distribution.</span></span>
<span><span class="co">#' The construction is described in Section 7.1 of Hobolth (2020).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param bM Subtransition probabilities un the underlying discrete Markov chain (cf. Figure 6).</span></span>
<span><span class="co">#' @param bA Statespace of the underlying block-counting process</span></span>
<span><span class="co">#' @param ba Vector of integer coeffcients</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return List consisting of</span></span>
<span><span class="co">#' bMt: The constructed matrix subtransition probabilities.</span></span>
<span><span class="co">#' sizes_of_blocks: The sizes of the constructed blocks.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' ba = c(1,2,3)</span></span>
<span><span class="co">#' ph_bcp = block_counting_process(4)</span></span>
<span><span class="co">#' subintensity_matrix = ph_bcp$subint_mat</span></span>
<span><span class="co">#' bA = ph_bcp$reward_mat</span></span>
<span><span class="co">#' ph = PH(subintensity_matrix)</span></span>
<span><span class="co">#' ph_rew_obj = reward_phase_type(ph, rowSums(rew_mat))</span></span>
<span><span class="co">#' bS = ph_rew_obj$subint_mat</span></span>
<span><span class="co">#' bM = solve(diag(dim(bS)[1])-(2/theta)*bS)</span></span>
<span><span class="co">#' DPHrep(ba,bM)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span>
<span></span>
<span></span>
<span><span class="va">DPHrep</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">bM</span>,<span class="va">bA</span>,<span class="va">ba</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bA</span><span class="op">)</span> <span class="co">#this is p in the paper</span></span>
<span>  <span class="va">sizes_of_blocks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">m</span><span class="op">)</span> <span class="co">#obtain the sizes of the blocks using formula XX</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sizes_of_blocks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ba</span><span class="op">*</span><span class="op">(</span><span class="va">bA</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">bMt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sizes_of_blocks</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sizes_of_blocks</span><span class="op">)</span><span class="op">)</span> <span class="co">#bold-Mtilde</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">&lt;=</span> <span class="va">j</span><span class="op">)</span> <span class="op">{</span> <span class="co">#off-diagonal blocks</span></span>
<span>        <span class="va">bmvec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">sizes_of_blocks</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="co"># The bottom row is calculated using formula DD</span></span>
<span>        <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">bmvec</span><span class="op">[</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">-</span><span class="va">k</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">bA</span><span class="op">[</span><span class="va">j</span>,<span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="va">ba</span> <span class="op">==</span> <span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">bmvec</span> <span class="op">=</span> <span class="va">bM</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">*</span><span class="va">bmvec</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">bmvec</span><span class="op">)</span></span>
<span>        <span class="va">cur_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="va">j</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">cur_j</span> <span class="op">=</span> <span class="fl">1</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">else</span> <span class="op">{</span></span>
<span>          <span class="va">cur_j</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">j</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">bMt</span><span class="op">[</span><span class="va">cur_i</span>,<span class="va">cur_j</span><span class="op">:</span><span class="op">(</span><span class="va">cur_j</span><span class="op">+</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="va">bmvec</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="co"># The diagonal-blocks are treated as a separate case</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="va">j</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">sizes_of_blocks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">size_of_current_block</span> <span class="op">=</span> <span class="va">sizes_of_blocks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>        <span class="va">cur_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="va">size_of_current_block</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>        <span class="va">cur_j</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="va">size_of_current_block</span> <span class="op">+</span> <span class="fl">2</span></span>
<span>        <span class="va">bMt</span><span class="op">[</span><span class="va">cur_i</span><span class="op">:</span><span class="op">(</span><span class="va">cur_i</span> <span class="op">+</span> <span class="va">size_of_current_block</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span>,<span class="va">cur_j</span><span class="op">:</span><span class="op">(</span><span class="va">cur_j</span> <span class="op">+</span>   <span class="va">size_of_current_block</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">size_of_current_block</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="co">#add identity-matrix of appropriate size</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">bMt</span>,<span class="va">sizes_of_blocks</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Rate matrix and state space of the block counting process</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' \code{RateMatAndStateSpace} finds the state space and corresponding rate matrix</span></span>
<span><span class="co">#' for the block counting process for a number of samples n in the</span></span>
<span><span class="co">#' standard coalescent.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param n Number of samples</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return List consisting of</span></span>
<span><span class="co">#' RateM: Rate matrix</span></span>
<span><span class="co">#' StSpM: Matrix with rows corresponding to the states</span></span>
<span><span class="co">#'        A state is a n-dimensional row vector (a1,...,an).</span></span>
<span><span class="co">#'        For example the beginning state is (n,0,...,0),</span></span>
<span><span class="co">#'        the next state is (n-2,1,0,...,0),</span></span>
<span><span class="co">#'        and the ending state is (0,...,0,1)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' RateMAndStateSpace(8)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span>
<span></span>
<span></span>
<span><span class="va">RateMAndStateSpace</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">##----------------------------------------------------</span></span>
<span>  <span class="co">## State space</span></span>
<span>  <span class="co">##----------------------------------------------------</span></span>
<span>  <span class="co">## Size of the state space (number of states)</span></span>
<span>  <span class="va">nSt</span> <span class="op">&lt;-</span> <span class="fu">partitions</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/partitions/man/P.html" class="external-link">P</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="co">## Definition of the state space</span></span>
<span>  <span class="va">StSpM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="va">n</span>,nrow<span class="op">=</span><span class="va">nSt</span><span class="op">)</span></span>
<span>  <span class="co">## Set of partitions of [n]</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">partitions</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/partitions/man/parts.html" class="external-link">parts</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="co">## Rewriting the partitions as (a1,...,an)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nSt</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">st</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">StSpM</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tabulate.html" class="external-link">tabulate</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,nbins<span class="op">=</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co">## Reordering</span></span>
<span>  <span class="va">StSpM</span> <span class="op">&lt;-</span> <span class="va">StSpM</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">StSpM</span><span class="op">)</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="co">## Because of this ordering we can't 'go back', i.e.</span></span>
<span>  <span class="co">## below the diagonal the entries are always zero</span></span>
<span>  <span class="co">##----------------------------------------------------</span></span>
<span>  <span class="co">## Intensity matrix</span></span>
<span>  <span class="co">##----------------------------------------------------</span></span>
<span>  <span class="va">RateM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,ncol<span class="op">=</span><span class="va">nSt</span>,nrow<span class="op">=</span><span class="va">nSt</span><span class="op">)</span></span>
<span>  <span class="co">## Following Algorithm 4.2</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">nSt</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="op">(</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">nSt</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="co"># cat(i," state i",StSpM[i,])</span></span>
<span>      <span class="co"># cat(" ",j," state j",StSpM[j,])</span></span>
<span>      <span class="va">cvec</span> <span class="op">&lt;-</span> <span class="va">StSpM</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">-</span><span class="va">StSpM</span><span class="op">[</span><span class="va">j</span>,<span class="op">]</span></span>
<span>      <span class="co"># cat(" cvec",cvec)</span></span>
<span>      <span class="co">## Two branches are merged, i.e. removed from state i</span></span>
<span>      <span class="va">check1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cvec</span><span class="op">[</span><span class="va">cvec</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">==</span><span class="fl">2</span></span>
<span>      <span class="co"># cat(" check1",check1)</span></span>
<span>      <span class="co">## One new branch is created, i.e. added in state from j</span></span>
<span>      <span class="va">check2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cvec</span><span class="op">[</span><span class="va">cvec</span><span class="op">&lt;</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">==</span><span class="op">-</span><span class="fl">1</span></span>
<span>      <span class="co"># cat(" check2",check2)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">check1</span> <span class="op">&amp;</span> <span class="va">check2</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="co">## Size(s) of the block(s) and the corresponding rates</span></span>
<span>        <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">StSpM</span><span class="op">[</span><span class="va">i</span>,<span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">cvec</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">]</span></span>
<span>        <span class="va">RateM</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span>,<span class="va">tmp</span><span class="op">*</span><span class="op">(</span><span class="va">tmp</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,<span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co">## Diagonal part of the rate matrix</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nSt</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">RateM</span><span class="op">[</span><span class="va">i</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">RateM</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>RateM<span class="op">=</span><span class="va">RateM</span>,StSpM<span class="op">=</span><span class="va">StSpM</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' \code{block_counting_process} return a the block counting process for a given sample size</span></span>
<span><span class="co">#' as a \code{mult_cont_phase_type} object.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param n Number of samples</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return ph_rew_ob</span></span>
<span><span class="co">#' A \code{mult_cont_phase_type} representation of the block counting process of size n</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' block_counting_process(8)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span>
<span></span>
<span></span>
<span><span class="va">block_counting_process</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">RMASS</span> <span class="op">=</span> <span class="fu">RateMAndStateSpace</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">RMASS</span><span class="op">$</span><span class="va">RateM</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co">#(m should be equal to partitions::P(n))</span></span>
<span>  <span class="co"># Obtain subintensity matrix</span></span>
<span>  <span class="va">ph</span> <span class="op">=</span> <span class="fu"><a href="../reference/generator_functions.html">PH</a></span><span class="op">(</span><span class="va">RMASS</span><span class="op">$</span><span class="va">RateM</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">m</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">m</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># The reward matrix is the state space matrix of the block counting process, except the row &amp; column related to the absorbing state.</span></span>
<span>  <span class="va">rew_mat</span> <span class="op">=</span> <span class="va">RMASS</span><span class="op">$</span><span class="va">StSpM</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">m</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">ph_rew_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/generator_functions.html">MPH</a></span><span class="op">(</span><span class="va">ph</span><span class="op">$</span><span class="va">subint_mat</span>, <span class="va">ph</span><span class="op">$</span><span class="va">init_probs</span>, reward_mat <span class="op">=</span> <span class="va">rew_mat</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ph_rew_obj</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div id="refs" class="references">
<div id="ref-asgertemp2020">
<p>Hobolth, A, M. Bladt, and L. A. Andersen. 2021. “Multivariate Phase-Type Theory for the Site Frequency Spectrum.”</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Iker Rivas-González, Asger Hobolth, Lars Nørvang Andersen, Colin Guetemme.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
